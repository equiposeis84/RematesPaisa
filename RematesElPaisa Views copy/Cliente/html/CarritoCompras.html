<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito - Remates El Paísa</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo">
                <h1>Remates El Paísa</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="Catalogo.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="nav-icon bi bi-archive" viewBox="0 0 16 16"> <path d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/></svg>
                        Catálogo
                    </a></li>
                   <li><a href="CarritoCompras.html" class="active">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="nav-icon bi bi-cart" viewBox="0 0 16 16"> <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
                        Carrito
                    </a></li>
                   <li><a href="Pedidos.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag" viewBox="0 0 16 16"> <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/> </svg>
                        Pedidos
                    </a></li>
                   <li><a href="Perfil.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="nav-icon bi bi-person-check" viewBox="0 0 16 16"> <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/> <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/></svg>
                        Perfil
                    </a></li>
                  
                </ul>
            </nav>
            <div class="user-section">
                <div class="user-info">
                    <p><strong>Conectado como: Cliente</strong></p>
                </div>
                <nav class="secondary-nav">
                    <ul>
                        <li><a href="AyudaContacto.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16"> <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/> <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/> </svg>
                            Ayuda y Contacto
                        </a></li>
                        <li><a href="../../Usuario/index.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0z"/> <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708z"/> </svg>
                            Cerrar Sesión
                        </a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <main class="main-content">
            <header class="content-header">
                <h2>Carrito de Compras</h2>
            </header>
            <section class="content-body">
                <div class="cart-items">
                    <table id="cart-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-product-id="1">
                                <td class="product-name">Producto 1</td>
                                <td>
                                    <input class="qty-input" type="number" min="1" value="2" aria-label="Cantidad Producto 1">
                                </td>
                                <td class="unit-price">50.00</td>
                                <td class="line-total">100.00</td>
                                <td><button class="remove-btn">Eliminar</button></td>
                            </tr>
                            <tr data-product-id="2">
                                <td class="product-name">Producto 2</td>
                                <td>
                                    <input class="qty-input" type="number" min="1" value="1" aria-label="Cantidad Producto 2">
                                </td>
                                <td class="unit-price">30.00</td>
                                <td class="line-total">30.00</td>
                                <td><button class="remove-btn">Eliminar</button></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" style="text-align:right"><strong>Total:</strong></td>
                                <td id="cart-total">130.00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
            </section>
            <div class ="ConfirmarPedido">
                <a href="ConfirmarPedido.html" class="confirm-btn">Confirmar Pedido</a>
            </div>
        </main>
    </div>

</body>
    <script>
        // Maneja cambios en cantidad y eliminaciones
        (function(){
            function toNumber(str){
                return Number(String(str).replace(/[^0-9.\-]+/g, '')) || 0;
            }

            function formatMoney(value){
                return value.toFixed(2);
            }

            function recalcRow(row){
                var qty = parseInt(row.querySelector('.qty-input').value, 10) || 0;
                if(qty < 1) { qty = 1; row.querySelector('.qty-input').value = 1; }
                var unit = toNumber(row.querySelector('.unit-price').textContent);
                var line = qty * unit;
                row.querySelector('.line-total').textContent = formatMoney(line);
                return line;
            }

            function recalcCart(){
                var rows = document.querySelectorAll('#cart-table tbody tr');
                var total = 0;
                rows.forEach(function(r){ total += recalcRow(r); });
                document.getElementById('cart-total').textContent = formatMoney(total);
                persistCart();
            }

            function persistCart(){
                try{
                    var items = [];
                    document.querySelectorAll('#cart-table tbody tr').forEach(function(r){
                        var id = r.getAttribute('data-product-id') || null;
                        var name = r.querySelector('.product-name').textContent.trim();
                        var qty = parseInt(r.querySelector('.qty-input').value,10) || 1;
                        var unit = toNumber(r.querySelector('.unit-price').textContent);
                        items.push({id: id, name: name, qty: qty, unit: unit});
                    });
                    localStorage.setItem('cart', JSON.stringify(items));
                }catch(e){
                    // ignore storage errors
                }
            }

            // Inicializar handlers
            document.addEventListener('DOMContentLoaded', function(){
                // qty change
                document.querySelectorAll('.qty-input').forEach(function(input){
                    input.addEventListener('change', function(){ recalcCart(); });
                    input.addEventListener('input', function(){ /* optional live update */ });
                });

                // remove buttons
                document.querySelectorAll('.remove-btn').forEach(function(btn){
                    btn.addEventListener('click', function(e){
                        var row = e.target.closest('tr');
                        if(row) { row.parentNode.removeChild(row); recalcCart(); }
                    });
                });

                // If there's a saved cart, try to load quantities
                try{
                    var saved = JSON.parse(localStorage.getItem('cart')||'[]');
                    if(saved && saved.length){
                        saved.forEach(function(item){
                            var row = document.querySelector('#cart-table tbody tr[data-product-id="'+item.id+'"]');
                            if(row){ row.querySelector('.qty-input').value = item.qty; }
                        });
                    }
                }catch(e){}

                recalcCart();
            });
        })();
    </script>
    <style>
        .remove-btn {
            background-color: #ff2a2a; /* Verde */
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        .ConfirmarPedido {
            text-align: center;
            margin-top: 20px;
        }
        .confirm-btn {
            background-color: #4CAF50; /* Verde */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
    </style>

</html>
